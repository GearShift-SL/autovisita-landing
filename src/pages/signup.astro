---
import SignupForm from '~/components/forms/SignupForm'
import Hero from '~/components/widgets/Hero.astro'
import PageLayout from '~/layouts/PageLayout.astro'

const seatsAvailable = 50
---

<PageLayout>
  <Hero title='Â¡RegÃ­strate y recibe un descuento!'>
    <Fragment slot='subtitle'>
      AutoVisita estÃ¡ a punto de lanzarse. <br /><br />
      ðŸŽ‰ Los primeros {seatsAvailable} clientes <span class='font-semibold'
        >recibirÃ¡n un descuento del 50%</span
      > en sus primeros 2 aÃ±os. ðŸŽ‰

      <br />

      <Fragment>
        <br />
        <span class='text-lg text-gray-500'>
          Â¡Solo quedan{' '}
          <span id='seats-remaining' class='font-semibold'>
            {seatsAvailable}
          </span>{' '}
          cupos disponibles! ðŸš€
        </span>
      </Fragment>
    </Fragment>
    <Fragment slot='content'>
      <SignupForm client:idle />
    </Fragment>
  </Hero>
</PageLayout>

<script>
  function updateSeatsRemaining() {
    fetch('/api/seats-remaining/')
      .then((response) => response.json())
      .then((data) => {
        const seatsRemainingElement = document.getElementById('seats-remaining')
        if (seatsRemainingElement) {
          seatsRemainingElement.textContent = data.seatsRemaining.toString()
        }
      })
      .catch((error) => console.error('Error fetching seats remaining:', error))
  }

  // Run the update function when the page loads
  document.addEventListener('astro:page-load', updateSeatsRemaining)
</script>
