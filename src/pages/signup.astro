---
import SignupForm from '~/components/forms/SignupForm'
import Hero from '~/components/widgets/Hero.astro'
import PageLayout from '~/layouts/PageLayout.astro'
import { getBrevoListDetails } from '~/utils/brevo'

const seatsAvailable = 50

const listIdStr: string = import.meta.env.BREVO_WAITLIST_LIST_ID
const listId = parseInt(listIdStr, 10)
const listDetails = await getBrevoListDetails(listId)
const contactsWaitlisted = listDetails?.totalSubscribers || 0
const seatsRemaining = seatsAvailable - contactsWaitlisted
---

<PageLayout>
  <Hero title='Â¡RegÃ­strate y recibe un descuento!'>
    <Fragment slot='subtitle'>
      AutoVisita estÃ¡ a punto de lanzarse. <br /><br />
      ðŸŽ‰ Los primeros {seatsAvailable} clientes <span class='font-semibold'
        >recibirÃ¡n un descuento del 50%</span
      > en sus primeros 2 aÃ±os. ðŸŽ‰

      <br />

      {
        contactsWaitlisted > 0 && (
          <Fragment>
            <br />
            <span class='text-lg text-gray-500'>
              Â¡Solo quedan <span class='font-semibold'>{seatsRemaining}</span>{' '}
              cupos disponibles! ðŸš€
            </span>
          </Fragment>
        )
      }
    </Fragment>
    <Fragment slot='content'>
      <SignupForm client:idle />
    </Fragment>
  </Hero>
  <!-- <SignupForm client:idle /> -->
</PageLayout>
